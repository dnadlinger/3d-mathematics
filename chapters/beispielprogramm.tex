% Anhang 'Beispielprogramm'
\chapter{Beispielprogramm}
\label{beispielprogramm}

Wie schon in der Einleitung erwähnt, habe ich mich während der letzten Monate nicht nur mit dem theoretischen Teil der 3D-Grafik auseinandergesetzt, sondern auch ein praktisches Projekt umgesetzt: einen kleinen Software-Renderer mit dem Namen \enquote{d4}, geschrieben in der Programmiersprache~D.

Bei einem Software Renderer handelt es sich um ein Programm, dass die 3D-Pipeline in Software implementiert, die Berechnungen also ausschließlich auf dem Hauptprozessor des Computers ausführt. Diese Vorgehensweise ist eigentlich seit Mitte der 90er-Jahre überholt, da mit der in praktisch allen PCs vorhandenen Grafikkarte ein hoch spezialisiertes und viel effizienteres Mittel zu Verfügung steht, um die Berechnungen durchzuführen. Beim Programmieren eines Software Renderers ist man aber gezwungen, sich mit vielen interessanten Details auseinanderzusetzen, über die man sich normalerweise dank leistungsfähriger Hardware und abstrahierender Programmierschnittstellen nicht weiter den Kopf zerbrechen muss.

Das Projekt ist auf der beiliegenden CD im Verzeichnis \path{d4} zu finden. Im Unterverzeichnis \path{src} befindet sich der rund 25\hairspace000-zeilige Quellcode des Programms\footnote{Die Dateien im Paket \path{assimp} sind lediglich eine 1:1-Übertragung der C-Schnittstelle der Assimp-Bibliothek in die Programmiersprache D, im Gegensatz zu den restlichen Programmteilen also kaum als meine eigene Arbeit zu betrachten.}. Die Dokumentation des Quellcodes sollte ausreichend genau sein, um Ihnen zu ermöglichen, darin zu stöbern. Ebenfalls nur für Programmierer interessant dürfte das Unterverzeichnis \path{build} sein. Es enhält die Konfigurationsdatei für das Programm \emph{dsss}\footnote{\url{http://www.dsource.org/projects/dsss}}, mit dessen Hilfe das Projekt aus den Quellen kompiliert werden kann.

Das Unterverzeichnis \path{bin} enthält die ausführbaren Dateien für Windows (\path{d4.exe}) und Linux (\path{d4}). Zum Ausführen des Programms sind einige externe Bibliotheken\footnote{Bei einer Programmbibliothek handelt es sich -- vereinfacht gesagt -- um eine Sammlung von Funktionen, die kein eigenständiges Programm bilden, sondern von anderen Programmen als Hilfsmodul eingebunden werden.} erforderlich, nämlich die Multimedia-Bibliothek \emph{SDL}\footnote{\url{http://www.libsdl.org/}}, die Bibliothek \emph{Assimp}\footnote{\url{http://assimp.sourceforge.net/}} zum Einlesen der Modelldateien und die Bibliothek \emph{DevIL}\footnote{\url{http://openil.sourceforge.net/}} zum Laden der Texturen. Für die 32\,bit-Versionen von Microsoft Windows befinden sich die Bibliotheksdateien (\path{*.dll}) bereits im \path{bin}-Verzeichnis, sodass in den meisten Fällen keine zusätzlichen Schritte nötig sein sollten. Unter Linux müssen die entsprechenden Pakete der Distribution installiert sein. Für den Fall, dass dies nicht ausreichen sollte, sind aktuelle Pakete auf den Websites der Bibliotheken abrufbar.
% @todo: Benötigte Versionen.

Das Programm erwartet als ersten Parameter den Dateinamen der Szene, die geladen werden soll. Dank der beiden exzellenten Bibliotheken werden jeweils knapp 30 mehr oder weniger verbreitete Modell- und Texturformate unterstüzt, eine genaue Auflistung findet sich auf den Websites der Bibliotheken und in der beiliegenden \path{README}-Datei. Um diesen Parameter anzugeben, kann das Programm natürlich von der Kommandozeile gestartet werden. Unter Windows dürfte es jedoch leichter sein, eine Verknüpfung zu der \path{.exe}-Datei an geigneter Stelle (etwa auf dem Desktop) anzulegen, und dann einfach eine Modelldatei per \emph{Drag\,\&\,Drop} auf die Verknüpfung \enquote{fallen zu lassen}. Im Verzeichnis \path{bin/models} befinden sich neben einigen einfachen geometrischen Grundkörpern auch zwei Modelle eines Fantasy-Zwerges von einem Künstler mit dem Pseudonym \emph{Psionic} (Unterverzeichnis \path{dwarf}), die sich einer Textur bedienen.

Das Programm akzeptiert noch zwei optionale Parameter, wenn es über die Kommandozeile aufgerufen wird: Mit dem Argument \argument{fakeColors} wird jeder Eckpunkt in einer eigenen Farbe gezeichnet, wodurch die dem Modell zugrundeliegende Struktur sichtbar gemacht wird. \argument{smoothNormals} weist das Programm an, beim Importieren von Modellen ohne Vertexnormalen Normalvektoren zu generieren, die eine \enquote{glatte} Oberfläche erzeugen (siehe Kapitel \ref{vertexnormals}).

Noch ein paar Worte zur Bedienung: Die Kamera kann mittels der Tasten \key{W}, \key{S}, \key{A} und \key{D} bewegt und mit den Pfeiltasten gedreht werden. Die auch als \key{Shift} bezeichnete \key{Umschalt}-Taste beschleunigt dabei die Bewegungen. Die Tasten in der unteren Reihe der Tastatur steuern verschiedene Funktionen des Programms: \key{Y} wechselt zwischen Flat Shading, Gouraud Shading und Gouraud Shading mit Texturen; \key{X} schaltet den Wireframe-Modus ein und aus; \key{C} steuert das Backface-Culling; \key{V} lässt die Welt um den Koordinatenursprung drehen; \key{B} erzeugt einen animierten Farbverlauf im Hintergrund. Ein Druck auf die \key{Esc}-Taste beendet das Programm.